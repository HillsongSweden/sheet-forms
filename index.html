<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test form</title>
    <script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
    <link href="index.css" rel="stylesheet">
  </head>
  <body>
    <form id="1bO7qQj3xxCEgh8YnR2QB3VT7k7tsTUHOi9xNw25g3ac" name="Sheet2" class="hillsong-form">
      <div>
        <label>
          First name
          <input type="text" name="firstname" placeholder="First name" required>
        </label>
      </div>

      <div>
        <label>
          Last name
          <input type="text" name="lastname" placeholder="Last name" required>
        </label >
      </div>

      <div>
        <label>
          Campus
          <select name="campus" required>
            <option value="City" selected>City</option>
            <option value="Norra">Norra</option>
            <option value="Södra">Södra</option>
            <option value="Göteborg">Göteborg</option>
            <option value="Jönköping">Jönköping</option>
            <option value="Örebro">Örebro</option>

            <option disabled>—</option>
            <option value="Har inget campus">Har inget campus</option> 
          </select>
        </label>
      </div>

      <div>
        <label>
          <input type="radio" name="language" value="English" checked> English
        </label>
        <label>
          <input type="radio" name="language" value="Swedish"> Swedish
        </label>
      </div>

      <div>
        <label>
          <input type="checkbox" name="more_info" checked> I want more info
        </label>
        <label>
          <input type="checkbox" name="i_have_decided"> I have decided
        </label>
      </div>

      <div>
        <label>
          This can be a long text with line breaks!
          <textarea name="long_text" placeholder="This is the textarea placeholder text" rows="5" required></textarea>
        </label>
      </div>

      <input type="submit" value="Skicka">
    </form>
    <script>
      $(document).ready(function () {
        $.ajax({
          method: 'GET',
          url: 'https://sheets-forms.netlify.app/.netlify/functions/test',
          success: function (response) {
            console.log(response);
          },
          error: function (error) {
            console.error(error);
          }
        })
        var $form = $('.hillsong-form')
        var $submitBtn = $form.find('input[type=submit]');
        var $requiredFields = $form.find(':required').each(function () {
          $('<span style="color: red">*</span>').insertBefore(this);
        });
        $form.on('submit', function (event) {
          var rowData = $(this)
            .serializeArray()
            .reduce(function (acc, cur) {
                acc[cur.name] = cur.value
                return acc
              }, {});
          event.preventDefault();
          var sendingText = 'Skickar ';
          var intervalId = setInterval(function () {
              $submitBtn.val(
                sendingText = sendingText.length < 11
                  ? sendingText + '.'
                  : 'Skickar '
              );
          }, 500)

          $.ajax({
            url: 'http://localhost:8888/.netlify/functions/save-to-sheet',
            method: 'POST',
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            crossDomain: true,
            data: JSON.stringify({
              sheetId: $(this).attr('id'),
              sheetName: $(this).attr('name'),
              rowData: rowData
            }),
            success: function(response) {
              clearInterval(intervalId);
              $form.trigger('reset');
              $submitBtn.val('Skickat!');
              setTimeout(function() {
                $form
                  .find('input[type=submit]')
                  .val('Skicka');
                }, 3000);
            },
            error: function (error) {
              $submitBtn.val('Skicka');
              console.error('Error posting form data:');
              console.log(error);
            }
          });
        });
      });
    </script>
  </body>
</html>
